Name: yandex-porto
Version: @VERSION@
Release: 1
URL: https://wiki.yandex-team.ru/porto
#Source: https://git.yandex.ru/gitweb/search-admin/porto.git?a=snapshot;h=refs/tags/v@VERSION@/%{name}-%{version}.tar.gz
Source: https://git.yandex.ru/gitweb/search-admin/porto.git?a=snapshot;h=HEAD;sf=tgz#/%{name}-HEAD.tar.gz
Summary: Porto allows to run processes in containers
Group: Applications/System
License: Apache
Requires: ncurses, logrotate
BuildRequires: protobuf, protobuf-compiler, ncurses-devel, python2-devel, gcc-c++, systemd
Provides: python2-porto

%description
TODO

%package -n python2-%{name}
Summary: Python API for %{name}
Group: System Environment/Libraries

%description -n python2-%{name}
The python2-%{name} package contains Python API for %{name}.

%prep
%setup -qn porto

%build
%cmake -DUSE_SYSTEM_LIBNL=1 .
#make %{?_smp_mflags}
make

%install
make install DESTDIR=%{buildroot}

mkdir -p %{buildroot}/%{python2_sitelib}/porto
%{__install} api/python/porto/*.py %{buildroot}/%{python2_sitelib}/porto

%{__install} -D spec/porto.service %{buildroot}/%{_unitdir}/%{name}.service
%{__install} -D debian/yandex-porto.cron.d %{buildroot}/%{_sysconfdir}/cron.d/%{name}
%{__install} -D debian/logrotate-porto.conf %{buildroot}/%{_sysconfdir}/porto/%{name}

%files
%defattr(755,root,root)
%{_sbindir}/*
%{_unitdir}/*
%config(noreplace) %{_sysconfdir}/cron.d/%{name}
%config(noreplace) %{_sysconfdir}/porto/%{name}

%files -n python2-%{name}
%defattr(755,root,root)
%{python2_sitelib}/porto/*
