#!/bin/sh

set -e

bootstrap() {
	local root=$1

	debootstrap --arch amd64 trusty $root http://mirror.yandex.ru/ubuntu

	cat > $root/etc/resolvconf/resolv.conf.d/base <<EOF
search search.yandex.net yandex.ru
nameserver 2a02:6b8:0:3400::1
nameserver 2a02:6b8::1:1
options timeout:1 attempts:1
EOF
}

prepare() {
	resolvconf -u
	apt-get update
	apt-get install -y --force-yes debhelper devscripts git cmake g++ make libprotobuf-dev protobuf-compiler bison flex pkg-config autoconf libtool libprotobuf-dev
}

check() {
	git clone $1 $2
	cd $2
	git submodule init
	git submodule update
	debuild -i -us -uc -b
}

eval "$@"
