#!/bin/sh

set -e

bootstrap() {
	local root=$1

	curl -L https://github.com/fedora-cloud/docker-brew-fedora/blob/master/fedora-21-release.tar.xz?raw=true | tar -Jxf - -C $root

	cat > $root/etc/resolv.conf <<EOF
search search.yandex.net yandex.ru
nameserver 2a02:6b8:0:3400::1
nameserver 2a02:6b8::1:1
options timeout:1 attempts:1
EOF
}

prepare() {
	yum -y update
	yum -y install autoconf bison flex libtool fakeroot debhelper devscripts git cmake gcc gcc-c++ make libstdc++-devel libstdc++-static protobuf-static protobuf-devel protobuf-compiler
}

check() {
	debuild -i -us -uc -b -d
}

eval "$@"
