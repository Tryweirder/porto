# Build
git clone ssh://git.yandex.ru/search-admin/porto.git
sudo apt-get install build-essential libtool autoconfÂ§ pkg-config flex bison
cd porto
git submodule init
git submodule update
cmake .
make

# Build stable version of package
git checkout v0.7
debuild

# Release new version
./release

# Run fedora
yum -y --installroot=/home/stfomichev/src/porto/dist/fedora20 --releasever=20 --nogpg install systemd passwd yum fedora-release vim-minimal openssh-server procps-ng iproute net-tools dhclient
sudo ./portoctl exec fedora20 command="/sbin/init" root=/home/stfomichev/src/porto/dist/fedora20_stfomichev env="container=lxc" hostname="fedora20"
sudo ./portoctl exec fedora20 command="/bin/bash" root=/home/stfomichev/src/porto/dist/fedora20 env="container=lxc" user="$USER" group="$USER" hostname="fedora20"
sudo ./portoctl enter fedora20

# Run debian
sudo ./portoctl exec trusty command="/sbin/init" root=/home/stfomichev/src/porto/dist/trusty env="container=lxc"
TODO - fix SELinux:  Could not open policy file <= /etc/selinux/targeted/policy/policy.29:  No such file or directory

# Profile
~stfomichev/perf record -e cycles:u -g -- portod
~stfomichev/perf report --stdio

# Next release notes
* Phase 3 beta release which contains support for LXC-like isolation

* New features:
 - Multiple networks support: network data and properties are now per-device
 - New privilege mode: only root can create and start containers with custom user/group
 - New allowed_devices property
 - New net property to isolate container network and create macvlans
 - New bind property to bind host directories into container
 - New max_respawns property to limit total number of container respawns
 - New python api with OOP
 - New root property to isolate container filesystem
 - New hostname property to change container hostname and isolate UTS
 - New bind_dns property which binds host /etc/hosts and /etc/resolv.conf into container
 - New io_read/io_write data which container per device IO statistics
 - Set PORTO_HOST environment variable which contains host name
 - Set PORTO_NAME environment variable which contains container name
 - New meta containers as a way to limit resources for children containers

* Fixes:
 - Don't depend on system libnl version, build and use our own
 - Containers basedir is removed upon portod startup (when no containers restored)
 - Default number of clients changed to 128
 - Fix libporto crash on long protobuf messages
 - Start() error message is now returned via API (not via syslog)
 - Don't add container cwd to $PATH
 - Minor/major_faults now include children
 - Default net_guarantee is changed to 10Mbit
 - IPC is now isolated when isolate property is true
 - Cpu_priority property is now dynamic
 - Portoctl: don't add extra newline for get
 - Fix libporto hang when client doesn't have permissions to connect to socket
