# Build
git clone ssh://git.yandex.ru/search-admin/porto.git
sudo apt-get install build-essential libtool autoconf pkg-config flex bison
cd porto
git submodule init
git submodule update
cmake .
make

# Build stable version of package
git checkout v0.7
debuild

# Release new version
scripts/release

# Profile
cmake -DCMAKE_BUILD_TYPE=Debug . && make
~stfomichev/perf record -e cycles:u -g -F1000 -- portod
~stfomichev/perf report --stdio -n -G

# Coverage
cmake -DCMAKE_BUILD_TYPE=Debug . && make
HOST=vm ./scripts/remote_test false true stress
rm -rf porto && rsync -4 -av vm:src/porto $PWD
scripts/gencoverage porto coverage

# Debug netlink
NLDBG=10 NLCB=debug portod

# Locking scheme
## Containers
We have single lock on holder, and multiple locks for each container (child
containers share lock with topmost non-root parent so when we lock some child,
we have whole tree locked). Operations that add or remove containers
take holder lock, mark container as "in-progress", drop the lock and continue
construction/destruction with unlocked container. Other operations, that
modify or read container state find container in locked holder, acquire
container lock and drop holder lock.
Whenever we try to modify container that is currently "in-progress" (by taking
holder lock, finding container, and then locking individual container lock) we
return Busy error (so user can retry later).

## Volumes
We have single lock on volume holder, so any volume operation blocks others.


## Lock order

TVolume->Lock -> TVolumeHolder->Lock

TVolumeHolder->Lock -> TContainerHolder->Lock
